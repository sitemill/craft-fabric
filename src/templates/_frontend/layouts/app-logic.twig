{# Check for user access #}
{% set publicLayout = false %}
{% if craft.fabric.settings.private and not currentUser %}
    {% if publicPage is defined and publicPage == true %}
        {% set publicLayout = true %}
    {% else %}
        {% requireLogin %}
    {% endif %}
{% endif %}

{% set userPermissions = {} %}
{# Let's set global user permissions once to help with performance #}
{% if currentUser %}
    {% set userPermissions = {
        'isAdmin' : currentUser.admin
    } %}
{% endif %}

{# Get colors #}
{% include '_fabric/settings/colors.twig' %}

{# Get any URL Parameters #}
{% set keywords = craft.app.request.getParam('q')|default(null) %}
{% set category = category is defined ? category : null %}
{% set kind = craft.app.request.getParam('kind')|default('*') %}
{% set order = craft.app.request.getParam('order')|default('title asc') %}
{% set layout = craft.app.request.getParam('layout')|default('grid') %}

{# Get the entry sources #}
{% set entrySources = [] %}
{% for source, settings in craft.fabric.settings.entrySources if settings['enabled'] %}
    {% set entrySources = entrySources|merge({
        (source) : {
            'title': craft.sections.sectionByHandle(source).name,
            'thumbnailField': settings.thumbnailField is defined ? settings.thumbnailField
        }
    }) %}
{% endfor %}


{% block app %}
{% endblock %}