{% set title = title|default('Title') %}
{% set formAction = formAction|default(null) %}
{% set htmxTrigger = htmxTrigger|default(null) %}
{% set htmxSwapSection = htmxSwapSection|default(null) %}
{% set formRedirect = fromRedirect|default(craft.request.url) %}

{% if formAction %}
    {% requireLogin %}
{% endif %}

<div
        id="dialog"
        class="dialog | transition-all ease-in-out duration-500 bg-white fixed top-0 {% if formAction %}right-0{% else %}-right-dialog{% endif %} bottom-0 w-dialog z-50 shadow p-12"
        {% if formAction %}
            x-show="dialogOpen"
            x-data="{ dialogOpen: true }"
            x-transition:leave-start="opacity-100 transform right-0"
            x-transition:leave-end="opacity-0 transform -right-dialog"
            @click.away="dialogOpen = false"
        {% endif %}
>
    {% if formAction %}
        <form method="post"
              accept-charset="UTF-8"
              hx-ext="json-enc"
              hx-post="{{ actionUrl(formAction) }}"
              {% if htmxSwapSection %}hx-target="{{ htmxSwapSection }}"{% endif %}
                {% if htmxSwapSection %}hx-select="{{ htmxSwapSection }}"{% endif %}
              hx-indicator="#page-loader"
              hx-swap="outerHTML"
                {% if htmxTrigger %}hx-trigger="{{ htmxTrigger }}"{% endif %}
              class="dialog__form | flex flex-col justify-between h-full"
        >
            <input type="hidden" name="action" value="{{ formAction }}">
            <input type="hidden" name="htmx" value="true">
            <input type="hidden" name="elementId" value="{{ id }}">
            <input type="hidden" name="redirect" value="{{ formRedirect }}">

            {{ csrfInput() }}
            <div class="dialog__main">
                <h1 class="dialog__title">{{ title }}</h1>
                {% block main %}

                {% endblock %}
            </div>
            <div class="dialog__actions">
                {% block actions %}
                    <a @click="dialogOpen = false"
                       class="action action--large action--outline action--full-width text-primary bg-canvas border-primary">Close</a>
                {% endblock %}
            </div>
        </form>
    {% endif %}
</div>