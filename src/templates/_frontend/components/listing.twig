{# Required #}
{% set items = items %}
{% set elementType = elementType %} {# asset | entry #}
{% set thumbnailField = thumbnailField|default('') %} {# We can accept a thumbnail field if we know entries are from same section #}
{% set layout = layout|default('grid') %}

{# TODO: cache based on element id #}

<div class="listing listing--{{ elementType }} | relative p-8 flex flex-wrap">
    {% for item in items %}
        {% set thumbnail = '' %}
        {% if thumbnailField %}
            {% set thumbField = item[thumbnailField].one %}
            {% set thumbnail = thumbField and thumbField.instance == 'sitemill\\silo\\elements\\SiloAsset' ? thumbField.file : thumbField %}
        {% elseif elementType == 'asset' %}
            {% set thumbnail = craft.fabric.siloActive ? item.file : item %}
        {% elseif (elementType == 'entry' and craft.fabric.settings.entrySources|length) and craft.fabric.settings.entrySources[item.section.handle].thumbnailField %}
            {% set thumbField = item[craft.fabric.settings.entrySources[item.section.handle].thumbnailField].one %}
            {% set thumbnail = thumbField and thumbField.instance == 'sitemill\\silo\\elements\\SiloAsset' ? thumbField.file : thumbField %}
        {% endif %}
        {% include '_fabric/components/card/' ~ layout with {
            item: item,
            elementType: elementType,
            thumbnail: thumbnail
        } only %}
    {% endfor %}
    <div class="flex-auto"></div>
</div>
