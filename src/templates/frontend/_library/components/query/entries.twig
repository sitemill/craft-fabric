{# Set default entries section selection based on settings #}
{% set defaultEntriesSections = [] %}
{% for source, value in craft.library.settings.entrySources if (value['enabled'] and value['showInSearch'])  %}
    {% set defaultEntriesSections = defaultEntriesSections|merge([source]) %}
{% endfor %}

{% set sections = sections|default(defaultEntriesSections) %}

{% set query = query|default(craft.entries.section(sections)
    .search(keywords)
    .relatedTo(category)
    .orderBy(order)
    .limit(30)) %}


{% paginate query as pageInfo, items %}


{% include '_library/components/listing.twig' with {
    items: items,
    type: 'entries'
} %}