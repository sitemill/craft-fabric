{# Required #}
{% set items = items %}
{% set elementType = elementType %} {# asset | entry #}
{% set thumbnailField = thumbnailField|default('') %} {# We can accept a thumbnail field if we know entries are from same section #}
{% set layout = layout|default('grid') %}

{# TODO: cache based on element id #}

<div class="listing listing--{{ elementType }}">
    {% for item in items %}
        {% set thumbnail = '' %}
        {% if thumbnailField %}
            {% set thumbField = item[thumbnailField].one %}
            {% set thumbnail = thumbField and thumbField.instance == 'sitemill\\dam\\elements\\DamAsset' ? thumbField.file : thumbField %}
        {% elseif elementType == 'asset' %}
            {% set thumbnail = craft.library.damActive ? item.file : item %}
        {% elseif elementType == 'entry' and entrySources[item.section.handle].thumbnailField %}
            {% set thumbField = item[entrySources[item.section.handle].thumbnailField].one %}
            {% set thumbnail = thumbField and thumbField.instance == 'sitemill\\dam\\elements\\DamAsset' ? thumbField.file : thumbField %}
        {% endif %}
        {% include '_library/components/card/' ~ layout with {
            item: item,
            elementType: elementType,
            thumbnail: thumbnail
        } only %}
    {% endfor %}
</div>


{# {% if item[thumbnailField].one == 'sitemill\\dam\\fields\\DamAssetsField'  %} #}
{# {% set thumbnail = item[thumbnailField]|length ? item[thumbnailField].one.file : null %} #}
{# {% else %} #}
{# {% set thumbnail = item[thumbnailField]|length ? item[thumbnailField].one : null %} #}
{# {% endif %} #}